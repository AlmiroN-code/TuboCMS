# Requirements Document

## Introduction

Комплексное расширение функциональности RexTube для повышения вовлечённости пользователей. Включает систему плейлистов, историю просмотров, лайки/дизлайки, подписки на авторов, закладки, рекомендации, расширенную фильтрацию, улучшенные комментарии с уведомлениями, шаринг в соцсети, профили пользователей, связанные видео, серии/сезоны и превью при наведении.

## Glossary

- **Playlist** - пользовательская коллекция видео с возможностью упорядочивания
- **Watch History** - автоматически записываемая история просмотренных видео
- **Like/Dislike** - система оценки видео пользователями
- **Subscription** - подписка на автора для получения уведомлений о новых видео
- **Bookmark** - сохранение видео в избранное для быстрого доступа
- **Recommendation** - алгоритмически подобранные видео на основе истории просмотров
- **Video Series** - группа связанных видео, объединённых в серию/сезон
- **Animated Preview** - анимированное превью видео при наведении курсора
- **Mention** - упоминание пользователя через @username в комментариях

## Requirements

### Requirement 1: Плейлисты

**User Story:** Как пользователь, я хочу создавать и управлять плейлистами видео, чтобы организовывать контент по своим предпочтениям.

#### Acceptance Criteria

1. WHEN пользователь нажимает "Создать плейлист" THEN система SHALL создать новый плейлист с указанным названием и описанием
2. WHEN пользователь добавляет видео в плейлист THEN система SHALL добавить видео в конец списка плейлиста
3. WHEN пользователь перетаскивает видео в плейлисте THEN система SHALL изменить порядок видео согласно новой позиции
4. WHEN пользователь удаляет видео из плейлиста THEN система SHALL удалить видео из плейлиста без удаления самого видео
5. WHEN пользователь устанавливает приватность плейлиста THEN система SHALL ограничить доступ к плейлисту согласно настройкам (публичный/приватный)
6. WHEN пользователь открывает страницу плейлиста THEN система SHALL отобразить список видео с возможностью последовательного воспроизведения

### Requirement 2: История просмотров

**User Story:** Как пользователь, я хочу видеть историю просмотренных видео, чтобы легко находить ранее просмотренный контент.

#### Acceptance Criteria

1. WHEN пользователь просматривает видео более 10 секунд THEN система SHALL записать видео в историю просмотров с временной меткой
2. WHEN пользователь открывает страницу истории THEN система SHALL отобразить список просмотренных видео в хронологическом порядке (новые сверху)
3. WHEN пользователь удаляет запись из истории THEN система SHALL удалить выбранную запись без влияния на другие данные
4. WHEN пользователь очищает всю историю THEN система SHALL удалить все записи истории просмотров пользователя
5. WHEN видео уже есть в истории и пользователь смотрит его снова THEN система SHALL обновить временную метку существующей записи

### Requirement 3: Лайки и дизлайки

**User Story:** Как пользователь, я хочу ставить лайки и дизлайки видео, чтобы выражать своё отношение к контенту.

#### Acceptance Criteria

1. WHEN авторизованный пользователь нажимает кнопку лайка THEN система SHALL увеличить счётчик лайков на 1 и сохранить оценку пользователя
2. WHEN авторизованный пользователь нажимает кнопку дизлайка THEN система SHALL увеличить счётчик дизлайков на 1 и сохранить оценку пользователя
3. WHEN пользователь меняет оценку с лайка на дизлайк THEN система SHALL уменьшить счётчик лайков и увеличить счётчик дизлайков
4. WHEN пользователь повторно нажимает на свою текущую оценку THEN система SHALL отменить оценку и уменьшить соответствующий счётчик
5. WHEN неавторизованный пользователь пытается поставить оценку THEN система SHALL перенаправить на страницу авторизации
6. WHEN пользователь открывает страницу видео THEN система SHALL отобразить текущие счётчики лайков и дизлайков

### Requirement 4: Подписки на авторов

**User Story:** Как пользователь, я хочу подписываться на авторов, чтобы получать уведомления о новых видео.

#### Acceptance Criteria

1. WHEN пользователь нажимает "Подписаться" на странице автора THEN система SHALL создать подписку и увеличить счётчик подписчиков автора
2. WHEN пользователь нажимает "Отписаться" THEN система SHALL удалить подписку и уменьшить счётчик подписчиков
3. WHEN автор публикует новое видео THEN система SHALL отправить уведомление всем подписчикам
4. WHEN пользователь открывает страницу подписок THEN система SHALL отобразить список авторов с их последними видео
5. WHEN пользователь открывает профиль автора THEN система SHALL отобразить количество подписчиков и статус подписки текущего пользователя

### Requirement 5: Закладки (избранное)

**User Story:** Как пользователь, я хочу добавлять видео в избранное, чтобы быстро находить понравившийся контент.

#### Acceptance Criteria

1. WHEN пользователь нажимает "Добавить в избранное" THEN система SHALL добавить видео в список закладок пользователя
2. WHEN пользователь нажимает "Удалить из избранного" THEN система SHALL удалить видео из списка закладок
3. WHEN пользователь открывает страницу избранного THEN система SHALL отобразить все закладки с сортировкой по дате добавления
4. WHEN пользователь просматривает карточку видео THEN система SHALL отобразить индикатор, если видео в избранном


### Requirement 6: Рекомендации на основе просмотров

**User Story:** Как пользователь, я хочу получать персонализированные рекомендации видео, чтобы находить интересный контент.

#### Acceptance Criteria

1. WHEN пользователь открывает главную страницу THEN система SHALL отобразить блок рекомендованных видео на основе истории просмотров
2. WHEN у пользователя недостаточно истории просмотров THEN система SHALL отобразить популярные видео из категорий, которые он просматривал
3. WHEN пользователь просматривает видео THEN система SHALL обновить профиль предпочтений пользователя (категории, теги, авторы)
4. WHEN система генерирует рекомендации THEN система SHALL учитывать категории, теги и авторов из истории просмотров

### Requirement 7: Расширенная фильтрация видео

**User Story:** Как пользователь, я хочу фильтровать видео по различным параметрам, чтобы быстрее находить нужный контент.

#### Acceptance Criteria

1. WHEN пользователь выбирает фильтр по длительности THEN система SHALL отобразить видео в выбранном диапазоне (короткие <5мин, средние 5-20мин, длинные >20мин)
2. WHEN пользователь выбирает сортировку по дате THEN система SHALL отсортировать видео по дате публикации (новые/старые)
3. WHEN пользователь выбирает сортировку по популярности THEN система SHALL отсортировать видео по количеству просмотров
4. WHEN пользователь выбирает сортировку по рейтингу THEN система SHALL отсортировать видео по соотношению лайков к дизлайкам
5. WHEN пользователь применяет несколько фильтров THEN система SHALL применить все фильтры одновременно
6. WHEN пользователь сбрасывает фильтры THEN система SHALL вернуть отображение к настройкам по умолчанию

### Requirement 8: Улучшенные комментарии

**User Story:** Как пользователь, я хочу отвечать на комментарии и упоминать других пользователей, чтобы вести дискуссии.

#### Acceptance Criteria

1. WHEN пользователь отвечает на комментарий THEN система SHALL создать вложенный комментарий и уведомить автора родительского комментария
2. WHEN пользователь упоминает @username в комментарии THEN система SHALL отправить уведомление упомянутому пользователю
3. WHEN пользователь вводит @ в поле комментария THEN система SHALL отобразить автодополнение с именами пользователей
4. WHEN комментарий содержит упоминание THEN система SHALL отобразить @username как кликабельную ссылку на профиль
5. WHEN пользователь получает уведомление о комментарии THEN система SHALL отобразить превью комментария и ссылку на видео

### Requirement 9: Шаринг в социальные сети

**User Story:** Как пользователь, я хочу делиться видео в социальных сетях, чтобы рекомендовать контент друзьям.

#### Acceptance Criteria

1. WHEN пользователь нажимает кнопку "Поделиться" THEN система SHALL отобразить модальное окно с вариантами шаринга
2. WHEN пользователь выбирает социальную сеть THEN система SHALL открыть окно шаринга выбранной соцсети с предзаполненными данными
3. WHEN пользователь копирует ссылку THEN система SHALL скопировать URL видео в буфер обмена и показать подтверждение
4. WHEN система генерирует ссылку для шаринга THEN система SHALL включить Open Graph метатеги для корректного превью

### Requirement 10: Профили пользователей

**User Story:** Как пользователь, я хочу настраивать свой профиль с аватаром и биографией, чтобы персонализировать свой аккаунт.

#### Acceptance Criteria

1. WHEN пользователь загружает аватар THEN система SHALL сохранить изображение и отобразить его в профиле и комментариях
2. WHEN пользователь редактирует биографию THEN система SHALL сохранить текст и отобразить его на странице профиля
3. WHEN пользователь открывает чужой профиль THEN система SHALL отобразить аватар, био, количество видео и подписчиков
4. WHEN пользователь загружает аватар неподдерживаемого формата THEN система SHALL отобразить сообщение об ошибке
5. WHEN аватар превышает максимальный размер THEN система SHALL автоматически сжать изображение до допустимого размера

### Requirement 11: Связанные видео

**User Story:** Как пользователь, я хочу видеть связанные видео на странице просмотра, чтобы находить похожий контент.

#### Acceptance Criteria

1. WHEN пользователь открывает страницу видео THEN система SHALL отобразить блок связанных видео в сайдбаре
2. WHEN система подбирает связанные видео THEN система SHALL учитывать общие теги, категорию и автора
3. WHEN видео является частью серии THEN система SHALL приоритетно отобразить другие видео из той же серии
4. WHEN связанных видео недостаточно THEN система SHALL дополнить список популярными видео из той же категории

### Requirement 12: Серии и сезоны

**User Story:** Как автор, я хочу объединять видео в серии и сезоны, чтобы организовывать связанный контент.

#### Acceptance Criteria

1. WHEN автор создаёт серию THEN система SHALL создать контейнер для видео с названием, описанием и обложкой
2. WHEN автор добавляет видео в серию THEN система SHALL присвоить видео номер эпизода и связать с серией
3. WHEN автор создаёт сезон в серии THEN система SHALL создать подгруппу для организации эпизодов
4. WHEN пользователь открывает страницу серии THEN система SHALL отобразить все сезоны и эпизоды в правильном порядке
5. WHEN пользователь смотрит видео из серии THEN система SHALL отобразить навигацию к предыдущему/следующему эпизоду
6. WHEN пользователь завершает просмотр эпизода THEN система SHALL предложить автовоспроизведение следующего эпизода

### Requirement 13: Превью при наведении

**User Story:** Как пользователь, я хочу видеть анимированное превью при наведении на карточку видео, чтобы быстро оценить содержание.

#### Acceptance Criteria

1. WHEN пользователь наводит курсор на карточку видео THEN система SHALL отобразить анимированное превью через 500мс
2. WHEN пользователь убирает курсор с карточки THEN система SHALL остановить воспроизведение превью и вернуть статичный постер
3. WHEN система обрабатывает загруженное видео THEN система SHALL автоматически генерировать анимированное превью (WebP/GIF)
4. WHEN анимированное превью недоступно THEN система SHALL отобразить статичный постер без анимации
5. WHEN пользователь использует мобильное устройство THEN система SHALL отключить автоматическое превью для экономии трафика
