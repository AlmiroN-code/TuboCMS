{% extends 'admin/base.html.twig' %}

{% block title %}{{ is_edit ? 'Редактирование поста' : 'Создание поста' }}{% endblock %}
{% block page_title %}{{ is_edit ? 'Редактирование поста' : 'Создание поста' }}{% endblock %}

{% block content %}
<form method="post" enctype="multipart/form-data" class="space-y-6">
    <div class="bg-white rounded-lg shadow">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">{{ is_edit ? 'Редактирование поста' : 'Создание поста' }}</h3>
        </div>

        <div class="p-6 space-y-6">
            {# Основная информация #}
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="lg:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Заголовок *</label>
                    <input type="text" name="title" value="{{ post.title }}" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Slug</label>
                    <input type="text" name="slug" value="{{ post.slug }}"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="Автоматически из заголовка">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Статус</label>
                    <select name="status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="draft" {{ post.status == 'draft' ? 'selected' : '' }}>Черновик</option>
                        <option value="published" {{ post.status == 'published' ? 'selected' : '' }}>Опубликован</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Родительский пост</label>
                    <select name="parent_id" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Нет (корневой пост)</option>
                        {% for parent_post in parent_posts %}
                            {% if not is_edit or parent_post.id != post.id %}
                                <option value="{{ parent_post.id }}" {{ post.parent and post.parent.id == parent_post.id ? 'selected' : '' }}>
                                    {{ parent_post.title }}
                                </option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Порядок сортировки</label>
                    <input type="number" name="sort_order" value="{{ post.sortOrder }}" min="0"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
            </div>

            {# Категории #}
            {% if categories|length > 0 %}
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Категории</label>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                        {% for category in categories %}
                            <label class="flex items-center">
                                <input type="checkbox" name="categories[]" value="{{ category.id }}"
                                       {{ post.categories.contains(category) ? 'checked' : '' }}
                                       class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-2 text-sm text-gray-700">{{ category.name }}</span>
                            </label>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}

            {# Краткое описание #}
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Краткое описание</label>
                <textarea name="excerpt" rows="3"
                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          placeholder="Краткое описание поста для превью">{{ post.excerpt }}</textarea>
            </div>

            {# Содержимое #}
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Содержимое</label>
                <textarea name="content" rows="15"
                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          placeholder="Содержимое поста (поддерживается HTML)">{{ post.content }}</textarea>
            </div>

            {# Изображение #}
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Изображение поста</label>
                {% if post.featuredImage %}
                    <div class="mb-3">
                        <img src="/media/posts/{{ post.featuredImage }}" alt="Текущее изображение" class="w-32 h-32 object-cover rounded">
                        <p class="text-sm text-gray-500 mt-1">Текущее изображение</p>
                    </div>
                {% endif %}
                <input type="file" name="featured_image" accept="image/*"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <p class="text-sm text-gray-500 mt-1">Поддерживаются форматы: JPG, PNG, GIF</p>
            </div>

            {# Активность #}
            <div>
                <label class="flex items-center">
                    <input type="checkbox" name="is_active" value="1" {{ post.isActive ? 'checked' : '' }}
                           class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                    <span class="ml-2 text-sm text-gray-700">Активен</span>
                </label>
            </div>
        </div>
    </div>

    {# SEO настройки #}
    <div class="bg-white rounded-lg shadow">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">SEO настройки</h3>
        </div>

        <div class="p-6 space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Meta Title</label>
                <input type="text" name="meta_title" value="{{ post.metaTitle }}"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                       placeholder="Если не указан, будет использован заголовок поста">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Meta Description</label>
                <textarea name="meta_description" rows="3"
                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          placeholder="Описание для поисковых систем">{{ post.metaDescription }}</textarea>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Meta Keywords</label>
                <input type="text" name="meta_keywords" value="{{ post.metaKeywords }}"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                       placeholder="Ключевые слова через запятую">
            </div>
        </div>
    </div>

    {# Кнопки действий #}
    <div class="flex justify-between">
        <a href="{{ path('admin_posts') }}" class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-6 py-2 rounded-md">
            Отмена
        </a>
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md">
            {{ is_edit ? 'Обновить пост' : 'Создать пост' }}
        </button>
    </div>
</form>
{% endblock %}