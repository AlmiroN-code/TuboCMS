{% extends 'admin/base.html.twig' %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Workflow{% endblock %}
{% block page_title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Workflow{% endblock %}

{% block content %}
{# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º #}
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    {# –°—Ç–∞—Ç—É—Å—ã –≤–∏–¥–µ–æ #}
    <div class="bg-white rounded-md shadow">
        <div class="px-6 py-4 border-b">
            <h3 class="text-lg font-semibold text-gray-900">üé¨ –°—Ç–∞—Ç—É—Å—ã –≤–∏–¥–µ–æ</h3>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-gray-50 rounded-md p-4 text-center">
                    <div class="text-3xl font-bold text-gray-600">{{ videoStats.draft }}</div>
                    <div class="text-sm text-gray-500">–ß–µ—Ä–Ω–æ–≤–∏–∫–∏</div>
                </div>
                <div class="bg-blue-50 rounded-md p-4 text-center">
                    <div class="text-3xl font-bold text-blue-600">{{ videoStats.processing }}</div>
                    <div class="text-sm text-blue-500">–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</div>
                </div>
                <div class="bg-green-50 rounded-md p-4 text-center">
                    <div class="text-3xl font-bold text-green-600">{{ videoStats.published }}</div>
                    <div class="text-sm text-green-500">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</div>
                </div>
                <div class="bg-yellow-50 rounded-md p-4 text-center">
                    <div class="text-3xl font-bold text-yellow-600">{{ videoStats.private }}</div>
                    <div class="text-sm text-yellow-500">–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ</div>
                </div>
                <div class="bg-red-50 rounded-md p-4 text-center col-span-2">
                    <div class="text-3xl font-bold text-red-600">{{ videoStats.rejected }}</div>
                    <div class="text-sm text-red-500">–û—Ç–∫–ª–æ–Ω–µ–Ω–æ</div>
                </div>
            </div>
        </div>
    </div>

    {# –°—Ç–∞—Ç—É—Å—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ #}
    <div class="bg-white rounded-md shadow">
        <div class="px-6 py-4 border-b">
            <h3 class="text-lg font-semibold text-gray-900">üí¨ –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</h3>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-yellow-50 rounded-md p-4 text-center">
                    <div class="text-3xl font-bold text-yellow-600">{{ commentStats.pending }}</div>
                    <div class="text-sm text-yellow-500">–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>
                </div>
                <div class="bg-green-50 rounded-md p-4 text-center">
                    <div class="text-3xl font-bold text-green-600">{{ commentStats.approved }}</div>
                    <div class="text-sm text-green-500">–û–¥–æ–±—Ä–µ–Ω–æ</div>
                </div>
                <div class="bg-red-50 rounded-md p-4 text-center">
                    <div class="text-3xl font-bold text-red-600">{{ commentStats.rejected }}</div>
                    <div class="text-sm text-red-500">–û—Ç–∫–ª–æ–Ω–µ–Ω–æ</div>
                </div>
                <div class="bg-gray-50 rounded-md p-4 text-center">
                    <div class="text-3xl font-bold text-gray-600">{{ commentStats.spam }}</div>
                    <div class="text-sm text-gray-500">–°–ø–∞–º</div>
                </div>
            </div>
        </div>
    </div>
</div>

{# –í–∏–¥–µ–æ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ #}
{% if processingVideos|length > 0 %}
<div class="bg-white rounded-md shadow mb-6">
    <div class="px-6 py-4 border-b">
        <h3 class="text-lg font-semibold text-gray-900">‚è≥ –í–∏–¥–µ–æ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ</h3>
    </div>
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–í–∏–¥–µ–æ</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–ê–≤—Ç–æ—Ä</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–û–±–Ω–æ–≤–ª–µ–Ω–æ</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for video in processingVideos %}
                <tr>
                    <td class="px-6 py-4">
                        <div class="font-medium text-gray-900">{{ video.title|u.truncate(50) }}</div>
                    </td>
                    <td class="px-6 py-4 text-gray-600">{{ video.createdBy.username }}</td>
                    <td class="px-6 py-4 text-gray-500">{{ video.updatedAt|date('d.m.Y H:i') }}</td>
                    <td class="px-6 py-4">
                        <form action="{{ path('admin_workflow_video_transition', {id: video.id, transition: 'publish'}) }}" method="post" class="inline">
                            <input type="hidden" name="_token" value="{{ csrf_token('workflow_video_' ~ video.id) }}">
                            <button type="submit" class="text-green-600 hover:text-green-800 mr-2">‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
                        </form>
                        <form action="{{ path('admin_workflow_video_transition', {id: video.id, transition: 'reject'}) }}" method="post" class="inline">
                            <input type="hidden" name="_token" value="{{ csrf_token('workflow_video_' ~ video.id) }}">
                            <button type="submit" class="text-red-600 hover:text-red-800">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

{# –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ #}
{% if pendingComments|length > 0 %}
<div class="bg-white rounded-md shadow">
    <div class="px-6 py-4 border-b">
        <h3 class="text-lg font-semibold text-gray-900">üìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</h3>
    </div>
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–ê–≤—Ç–æ—Ä</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–î–∞—Ç–∞</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for comment in pendingComments %}
                <tr>
                    <td class="px-6 py-4">
                        <div class="text-gray-900">{{ comment.content|u.truncate(100) }}</div>
                        <div class="text-sm text-gray-500">–ö –≤–∏–¥–µ–æ: {{ comment.video.title|u.truncate(30) }}</div>
                    </td>
                    <td class="px-6 py-4 text-gray-600">{{ comment.user.username }}</td>
                    <td class="px-6 py-4 text-gray-500">{{ comment.createdAt|date('d.m.Y H:i') }}</td>
                    <td class="px-6 py-4">
                        <form action="{{ path('admin_workflow_comment_transition', {id: comment.id, transition: 'approve'}) }}" method="post" class="inline">
                            <input type="hidden" name="_token" value="{{ csrf_token('workflow_comment_' ~ comment.id) }}">
                            <button type="submit" class="text-green-600 hover:text-green-800 mr-2">‚úÖ</button>
                        </form>
                        <form action="{{ path('admin_workflow_comment_transition', {id: comment.id, transition: 'reject'}) }}" method="post" class="inline">
                            <input type="hidden" name="_token" value="{{ csrf_token('workflow_comment_' ~ comment.id) }}">
                            <button type="submit" class="text-red-600 hover:text-red-800 mr-2">‚ùå</button>
                        </form>
                        <form action="{{ path('admin_workflow_comment_transition', {id: comment.id, transition: 'mark_spam'}) }}" method="post" class="inline">
                            <input type="hidden" name="_token" value="{{ csrf_token('workflow_comment_' ~ comment.id) }}">
                            <button type="submit" class="text-gray-600 hover:text-gray-800">üö´</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

{# –î–∏–∞–≥—Ä–∞–º–º–∞ workflow #}
<div class="bg-white rounded-md shadow mt-6">
    <div class="px-6 py-4 border-b">
        <h3 class="text-lg font-semibold text-gray-900">üìä –°—Ö–µ–º–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤</h3>
    </div>
    <div class="p-6">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div>
                <h4 class="font-semibold text-gray-700 mb-3">Video Status Workflow</h4>
                <div class="bg-gray-50 rounded-md p-4 text-sm font-mono">
                    <div class="mb-2">draft ‚Üí <span class="text-blue-600">submit_for_processing</span> ‚Üí processing</div>
                    <div class="mb-2">processing ‚Üí <span class="text-green-600">publish</span> ‚Üí published</div>
                    <div class="mb-2">processing ‚Üí <span class="text-red-600">reject</span> ‚Üí rejected</div>
                    <div class="mb-2">published ‚Üí <span class="text-yellow-600">make_private</span> ‚Üí private</div>
                    <div class="mb-2">private ‚Üí <span class="text-green-600">make_public</span> ‚Üí published</div>
                    <div>published ‚Üí <span class="text-gray-600">unpublish</span> ‚Üí draft</div>
                </div>
            </div>
            <div>
                <h4 class="font-semibold text-gray-700 mb-3">Comment Moderation Workflow</h4>
                <div class="bg-gray-50 rounded-md p-4 text-sm font-mono">
                    <div class="mb-2">pending ‚Üí <span class="text-green-600">approve</span> ‚Üí approved</div>
                    <div class="mb-2">pending ‚Üí <span class="text-red-600">reject</span> ‚Üí rejected</div>
                    <div class="mb-2">pending ‚Üí <span class="text-gray-600">mark_spam</span> ‚Üí spam</div>
                    <div class="mb-2">rejected ‚Üí <span class="text-blue-600">restore</span> ‚Üí pending</div>
                    <div>spam ‚Üí <span class="text-blue-600">restore</span> ‚Üí pending</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
