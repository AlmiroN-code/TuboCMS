{% extends 'admin/base.html.twig' %}

{% block title %}Настройки аналитики{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <div class="mb-6">
        <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100">Настройки аналитики</h1>
        <p class="mt-2 text-gray-600 dark:text-gray-400">Управление кодами отслеживания для различных сервисов аналитики</p>
    </div>

    {% for message in app.flashes('success') %}
        <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
            {{ message }}
        </div>
    {% endfor %}

    <form method="post" class="space-y-6">
        {# Google Analytics #}
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
            <div class="flex items-center gap-3 mb-4">
                <svg class="w-8 h-8 text-orange-500" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M22.84 2.998v17.999a3.003 3.003 0 01-3.003 3.003H4.155a3.003 3.003 0 01-3.003-3.003V2.998a3.003 3.003 0 013.003-3.003h15.682a3.003 3.003 0 013.003 3.003zM8.5 21.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zm7-7a2.5 2.5 0 100-5 2.5 2.5 0 000 5zm4-4a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"/>
                </svg>
                <div>
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">Google Analytics (GA4)</h2>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Отслеживание посетителей и поведения пользователей</p>
                </div>
            </div>

            <div class="space-y-4">
                <div>
                    <label for="google_analytics_id" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Measurement ID (G-XXXXXXXXXX)
                    </label>
                    <input type="text" 
                           id="google_analytics_id" 
                           name="google_analytics_id" 
                           value="{{ settings.google_analytics_id }}"
                           placeholder="G-XXXXXXXXXX"
                           class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-orange-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                </div>

                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4">
                    <h4 class="font-medium text-blue-900 dark:text-blue-300 mb-2">Как получить Measurement ID:</h4>
                    <ol class="list-decimal list-inside text-sm text-blue-800 dark:text-blue-400 space-y-1">
                        <li>Перейдите в <a href="https://analytics.google.com/" target="_blank" class="underline hover:text-blue-600">Google Analytics</a></li>
                        <li>Выберите свой аккаунт и ресурс</li>
                        <li>Перейдите в "Администратор" → "Потоки данных"</li>
                        <li>Скопируйте Measurement ID (формат: G-XXXXXXXXXX)</li>
                    </ol>
                </div>

                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-md p-4">
                    <h4 class="font-medium text-gray-900 dark:text-gray-100 mb-2">Отслеживаемые события:</h4>
                    <ul class="list-disc list-inside text-sm text-gray-700 dark:text-gray-300 space-y-1">
                        <li>Просмотры страниц (page_view)</li>
                        <li>Просмотры видео (video_view)</li>
                        <li>Поиск (search)</li>
                        <li>Регистрация (sign_up)</li>
                        <li>Вход (login)</li>
                        <li>Лайки и комментарии</li>
                        <li>Подписки на каналы</li>
                    </ul>
                </div>
            </div>
        </div>

        {# Яндекс.Метрика #}
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
            <div class="flex items-center gap-3 mb-4">
                <svg class="w-8 h-8 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M13.5 2.5h-3v19h3v-19zM17 2.5h-2v19h2v-19zM9 2.5H7v19h2v-19z"/>
                </svg>
                <div>
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">Яндекс.Метрика</h2>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Вебвизор, карты кликов, анализ поведения</p>
                </div>
            </div>

            <div class="space-y-4">
                <div>
                    <label for="yandex_metrica_id" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Номер счётчика
                    </label>
                    <input type="text" 
                           id="yandex_metrica_id" 
                           name="yandex_metrica_id" 
                           value="{{ settings.yandex_metrica_id }}"
                           placeholder="12345678"
                           class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                </div>

                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4">
                    <h4 class="font-medium text-blue-900 dark:text-blue-300 mb-2">Как получить номер счётчика:</h4>
                    <ol class="list-decimal list-inside text-sm text-blue-800 dark:text-blue-400 space-y-1">
                        <li>Перейдите в <a href="https://metrika.yandex.ru/" target="_blank" class="underline hover:text-blue-600">Яндекс.Метрику</a></li>
                        <li>Создайте новый счётчик или выберите существующий</li>
                        <li>Скопируйте номер счётчика (8-значное число)</li>
                    </ol>
                </div>

                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-md p-4">
                    <h4 class="font-medium text-gray-900 dark:text-gray-100 mb-2">Включенные функции:</h4>
                    <ul class="list-disc list-inside text-sm text-gray-700 dark:text-gray-300 space-y-1">
                        <li>Карта кликов (clickmap)</li>
                        <li>Отслеживание ссылок (trackLinks)</li>
                        <li>Точный показатель отказов (accurateTrackBounce)</li>
                        <li>Вебвизор (webvisor)</li>
                    </ul>
                </div>
            </div>
        </div>

        {# Facebook Pixel #}
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
            <div class="flex items-center gap-3 mb-4">
                <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                </svg>
                <div>
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">Facebook Pixel</h2>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Отслеживание конверсий и ретаргетинг</p>
                </div>
            </div>

            <div class="space-y-4">
                <div>
                    <label for="facebook_pixel_id" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Pixel ID
                    </label>
                    <input type="text" 
                           id="facebook_pixel_id" 
                           name="facebook_pixel_id" 
                           value="{{ settings.facebook_pixel_id }}"
                           placeholder="123456789012345"
                           class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                </div>

                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4">
                    <h4 class="font-medium text-blue-900 dark:text-blue-300 mb-2">Как получить Pixel ID:</h4>
                    <ol class="list-decimal list-inside text-sm text-blue-800 dark:text-blue-400 space-y-1">
                        <li>Перейдите в <a href="https://business.facebook.com/events_manager" target="_blank" class="underline hover:text-blue-600">Events Manager</a></li>
                        <li>Выберите свой пиксель или создайте новый</li>
                        <li>Скопируйте Pixel ID (15-значное число)</li>
                    </ol>
                </div>

                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-md p-4">
                    <h4 class="font-medium text-gray-900 dark:text-gray-100 mb-2">Отслеживаемые события:</h4>
                    <ul class="list-disc list-inside text-sm text-gray-700 dark:text-gray-300 space-y-1">
                        <li>PageView - просмотр страницы</li>
                        <li>ViewContent - просмотр контента</li>
                        <li>Search - поиск</li>
                        <li>CompleteRegistration - регистрация</li>
                    </ul>
                </div>
            </div>
        </div>

        {# Google Search Console #}
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
            <div class="flex items-center gap-3 mb-4">
                <svg class="w-8 h-8 text-green-500" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
                <div>
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">Google Search Console</h2>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Верификация сайта для мониторинга индексации</p>
                </div>
            </div>

            <div class="space-y-4">
                <div>
                    <label for="google_search_console_code" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Код верификации (мета-тег)
                    </label>
                    <input type="text" 
                           id="google_search_console_code" 
                           name="google_search_console_code" 
                           value="{{ settings.google_search_console_code }}"
                           placeholder="abcdefghijklmnopqrstuvwxyz123456"
                           class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                </div>

                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4">
                    <h4 class="font-medium text-blue-900 dark:text-blue-300 mb-2">Как получить код верификации:</h4>
                    <ol class="list-decimal list-inside text-sm text-blue-800 dark:text-blue-400 space-y-1">
                        <li>Перейдите в <a href="https://search.google.com/search-console" target="_blank" class="underline hover:text-blue-600">Google Search Console</a></li>
                        <li>Добавьте свой сайт</li>
                        <li>Выберите метод верификации "HTML-тег"</li>
                        <li>Скопируйте значение из атрибута content (без кавычек)</li>
                    </ol>
                    <p class="mt-2 text-xs text-blue-700 dark:text-blue-400">
                        Пример: из <code>&lt;meta name="google-site-verification" content="abc123"&gt;</code> скопируйте только <code>abc123</code>
                    </p>
                </div>

                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-md p-4">
                    <h4 class="font-medium text-gray-900 dark:text-gray-100 mb-2">Возможности Search Console:</h4>
                    <ul class="list-disc list-inside text-sm text-gray-700 dark:text-gray-300 space-y-1">
                        <li>Мониторинг индексации страниц</li>
                        <li>Анализ поисковых запросов</li>
                        <li>Проверка ошибок сканирования</li>
                        <li>Отправка sitemap.xml</li>
                    </ul>
                </div>
            </div>
        </div>

        {# Action Buttons #}
        <div class="flex justify-between items-center">
            <a href="{{ path('admin_settings') }}" 
               class="px-6 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                Назад
            </a>
            <button type="submit" 
                    class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">
                Сохранить настройки
            </button>
        </div>
    </form>
</div>
{% endblock %}
