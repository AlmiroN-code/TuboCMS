{% block sidebar %}
<aside class="sidebar flex-shrink-0 border-r border-gray-200 min-h-screen p-3">
	{# Popular Section #}
	<div class="bg-white mb-4">
		<nav class="space-y-1">
			<a href="{{ path('app_videos') }}" 
				class="flex items-center gap-3 px-3 py-2 text-sm rounded-md transition {{ app.request.attributes.get('_route') == 'app_videos' ? 'bg-orange-50 text-orange-600' : 'text-gray-700 hover:bg-gray-100' }}">
				<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
				</svg>
				{{ 'sidebar.all_videos'|trans }}
			</a>
			<a href="{{ path('app_videos_popular') }}" 
				class="flex items-center gap-3 px-3 py-2 text-sm rounded-md transition {{ app.request.attributes.get('_route') == 'app_videos_popular' ? 'bg-orange-50 text-orange-600' : 'text-gray-700 hover:bg-gray-100' }}">
				<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
				</svg>
				{{ 'sidebar.top_views'|trans }}
			</a>
			<a href="{{ path('app_videos_newest') }}" 
				class="flex items-center gap-3 px-3 py-2 text-sm rounded-md transition {{ app.request.attributes.get('_route') == 'app_videos_newest' ? 'bg-orange-50 text-orange-600' : 'text-gray-700 hover:bg-gray-100' }}">
				<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
				</svg>
				{{ 'sidebar.new'|trans }}
			</a>
			<a href="{{ path('app_videos_trending') }}" 
				class="flex items-center gap-3 px-3 py-2 text-sm rounded-md transition {{ app.request.attributes.get('_route') == 'app_videos_trending' ? 'bg-orange-50 text-orange-600' : 'text-gray-700 hover:bg-gray-100' }}">
				<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.879 16.121A3 3 0 1012.015 11L11 14H9c0 .768.293 1.536.879 2.121z"></path>
                </svg>
				{{ 'sidebar.trending'|trans }}
			</a>
		</nav>
	</div>
	{# Categories Section #}
	<div class="bg-white rounded-md mb-4">
		<h3 class="text-sm font-semibold text-gray-900 mb-3 ml-2 uppercase tracking-wide">{{ 'sidebar.categories'|trans }}</h3>
		{% set sidebar_categories = global_sidebar_categories %}
		{% if sidebar_categories|length > 0 %}
		<nav id="categories-list" class="space-y-1">
			{% for category in sidebar_categories %}
			<a href="{{ path('app_category_show', {slug: category.slug}) }}" 
				class="flex items-center justify-between px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md transition group {{ loop.index > 10 ? 'hidden-category hidden' : '' }} {{ app.request.attributes.get('_route') == 'app_category_show' and app.request.attributes.get('slug') == category.slug ? 'bg-orange-50 text-orange-600' : '' }}">
				<span class="flex items-center gap-2">
					<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
					</svg>
					{{ category.name }}
				</span>
				<span class="text-xs text-gray-500">{{ category.videosCount }}</span>
			</a>
			{% endfor %}
		</nav>
		{% if sidebar_categories|length > 10 %}
		<div class="mx-3">
			<button id="categories-toggle-btn" 
				onclick="toggleCategories()" 
				class="w-full flex items-center justify-center gap-2 px-3 py-2 text-sm text-orange-600 bg-white hover:bg-orange-50 rounded-md shadow transition font-medium">
				<svg id="categories-toggle-icon" class="w-4 h-4 transition-transform duration-200" style="transform: rotate(-90deg);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
				</svg>
				<span id="categories-toggle-text">{{ 'sidebar.show_all'|trans }}</span>
			</button>
		</div>
		{% endif %}
		<!-- <div class="mt-4 pt-4 border-t">
			<a href="{{ path('app_categories') }}" class="text-sm text-orange-600 hover:text-orange-700 font-medium">
			{{ 'sidebar.all_categories'|trans }}
			</a>
		</div> -->
		{% else %}
		<p class="text-sm text-gray-500">{{ 'sidebar.no_categories'|trans }}</p>
		{% endif %}
	</div>

	{# Реклама в сайдбаре #}
	<div class="my-4">
		{{ show_ad('sidebar', {'page': app.request.attributes.get('_route')}) }}
	</div>
</aside>
<script>
(function() {
	const STORAGE_KEY = 'sidebar_categories_expanded';
	const showAllText = '{{ 'sidebar.show_all'|trans }}';
	const hideText = '{{ 'sidebar.hide'|trans }}';
	let isAnimating = false;
	
	// Загружаем сохранённое состояние
	function loadState() {
		try {
			const saved = localStorage.getItem(STORAGE_KEY);
			// false = свёрнуто (по умолчанию), true = развёрнуто
			return saved === 'true';
		} catch (e) {
			return false;
		}
	}
	
	// Сохраняем состояние
	function saveState(expanded) {
		try {
			localStorage.setItem(STORAGE_KEY, expanded ? 'true' : 'false');
		} catch (e) {}
	}
	
	// Применяем состояние
	function applyState(expanded, animate = false) {
		const hiddenCategories = document.querySelectorAll('.hidden-category');
		const icon = document.getElementById('categories-toggle-icon');
		const text = document.getElementById('categories-toggle-text');
		
		if (!hiddenCategories.length) return;
		
		if (animate && isAnimating) return;
		
		if (animate) {
			isAnimating = true;
		}
		
		// Добавляем transition для всех элементов
		hiddenCategories.forEach(cat => {
			if (!cat.style.transition) {
				cat.style.transition = 'opacity 0.2s ease-out, transform 0.2s ease-out';
			}
		});
		
		if (expanded) {
			// Разворачиваем - показываем категории
			hiddenCategories.forEach((cat, index) => {
				cat.classList.remove('hidden');
				cat.style.display = '';
				
				if (animate) {
					// Начинаем с невидимого состояния
					cat.style.opacity = '0';
					cat.style.transform = 'translateY(-10px)';
					cat.style.transitionDelay = (index * 0.03) + 's';
					
					// Запускаем анимацию появления
					requestAnimationFrame(() => {
						requestAnimationFrame(() => {
							cat.style.opacity = '1';
							cat.style.transform = 'translateY(0)';
						});
					});
				} else {
					cat.style.opacity = '1';
					cat.style.transform = 'translateY(0)';
					cat.style.transitionDelay = '0s';
				}
			});
			
			if (animate) {
				setTimeout(() => {
					isAnimating = false;
					hiddenCategories.forEach(cat => {
						cat.style.transitionDelay = '0s';
					});
				}, 250 + hiddenCategories.length * 30);
			}
		} else {
			// Сворачиваем - скрываем категории
			if (animate) {
				hiddenCategories.forEach((cat, index) => {
					cat.style.transitionDelay = ((hiddenCategories.length - index - 1) * 0.02) + 's';
					cat.style.opacity = '0';
					cat.style.transform = 'translateY(-10px)';
				});
				
				// Скрываем после анимации
				setTimeout(() => {
					hiddenCategories.forEach(cat => {
						cat.classList.add('hidden');
						cat.style.transitionDelay = '0s';
					});
					isAnimating = false;
				}, 200 + hiddenCategories.length * 20);
			} else {
				hiddenCategories.forEach(cat => {
					cat.classList.add('hidden');
					cat.style.opacity = '0';
					cat.style.transform = 'translateY(-10px)';
				});
			}
		}
		
		// Обновляем иконку и текст
		if (icon) {
			icon.style.transform = expanded ? 'rotate(0deg)' : 'rotate(-90deg)';
		}
		
		if (text) {
			text.textContent = expanded ? hideText : showAllText;
		}
	}
	
	// Переключение
	window.toggleCategories = function() {
		if (isAnimating) return;
		
		const currentState = loadState();
		const newState = !currentState;
		
		saveState(newState);
		applyState(newState, true);
	};
	
	// Инициализация при загрузке
	function init() {
		const expanded = loadState();
		// Применяем сохранённое состояние без анимации
		applyState(expanded, false);
	}
	
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', init);
	} else {
		init();
	}
})();
</script>
{% endblock %}